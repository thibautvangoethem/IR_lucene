<head>
<style>
td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
</style>
</head><h1>How to use the C socket API in C++ on z/OS</h1><p>I'm having issues getting the C sockets API to work properly in <code>C++</code> on <code>z/OS</code>.</p>

<p>Although I am including <code>sys/socket.h</code>, I still get <strong>compile time errors</strong> telling me that <strong><code>AF_INET</code> is not defined</strong>.</p>

<p>Am I missing something obvious, or is this related to the fact that being on <code>z/OS</code> makes my problems much more complicated?</p>

<hr>

<p><strong>Update</strong> : Upon further investigation, I discovered that there is an <code>#ifdef</code> that I'm hitting. Apparently <code>z/OS</code> isn't happy unless I define which "type" of sockets I'm using with:</p>

<pre><code>#define _OE_SOCKETS
</code></pre>

<p>Now, I personally have no idea what this <code>_OE_SOCKETS</code> is actually for, so if any <code>z/OS</code> sockets programmers are out there (all 3 of you), perhaps you could give me a rundown of how this all works?</p>

<hr>

<p><strong>Test App</strong></p>

<pre><code>#include &lt;sys/socket.h&gt;

int main()
{
    return AF_INET;
}
</code></pre>

<p><strong>Compile/Link Output:</strong></p>

<pre><code>cxx -Wc,xplink -Wl,xplink -o inet_test inet.C

"./inet.C", line 5.16: CCN5274 (S) The name lookup for "AF_INET" did not find a declaration.
CCN0797(I) Compilation failed for file ./inet.C. Object file not created.
</code></pre>

<hr>

<p>A check of sys/sockets.h does include the definition I need, and as far as I can tell, it is not being blocked by any <code>#ifdef</code> statements.</p>

<p>I have however noticed it contains the following:</p>

<pre><code>#ifdef __cplusplus
  extern "C" {
#endif
</code></pre>

<p>which encapsulates basically the whole file? Not sure if it matters.</p>
<table> <tr><th>answers</th></tr><tr><td><p>I've had no trouble using the BSD sockets API in C++, in GNU/Linux. Here's the sample program I used:</p>

<pre><code>#include &lt;sys/socket.h&gt;

int
main()
{
    return AF_INET;
}
</code></pre>

<p>So my take on this is that z/OS is probably the complicating factor here, however, because I've never used z/OS before, much less programmed in it, I can't say this definitively. :-P</p>
</tr></td><tr><td><p>@Jax: The <code>extern "C"</code> thing matters, very very much. If a header file doesn't have one, then (unless it's a C++-only header file), you would have to enclose your <code>#include</code> with it:</p>

<pre><code>extern "C" {
#include &lt;sys/socket.h&gt;
// include other similarly non-compliant header files
}
</code></pre>

<p>Basically, anytime where a C++ program wants to link to C-based facilities, the <code>extern "C"</code> is vital. In practical terms, it means that the names used in external references will not be mangled, like normal C++ names would. <a href="http://www.parashift.com/c++-faq-lite/mixing-c-and-cpp.html" rel="noreferrer">Reference.</a></p>
</tr></td>