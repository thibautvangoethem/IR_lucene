<head>
<style>
td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
</style>
</head><h1>What does the ??!??! operator do in C?</h1><p>I saw a line of C that looked like this:</p>

<pre><code>!ErrorHasOccured() ??!??! HandleError();
</code></pre>

<p>It compiled correctly and seems to run ok. It seems like it's checking if an error has occurred, and if it has, it handles it. But I'm not really sure what it's actually doing or how it's doing it. It does look like the programmer is trying express their feelings about errors.</p>

<p>I have never seen the <code>??!??!</code> before in any programming language, and I can't find documentation for it anywhere. (Google doesn't help with search terms like <code>??!??!</code>). What does it do and how does the code sample work?</p>
<table> <tr><th>answers</th></tr><tr><td><p><code>??!</code> is a <a href="http://en.wikipedia.org/wiki/Digraphs_and_trigraphs#C" rel="noreferrer">trigraph</a> that translates to <code>|</code>. So it says:</p>

<pre><code>!ErrorHasOccured() || HandleError();
</code></pre>

<p>which, due to short circuiting, is equivalent to:</p>

<pre><code>if (ErrorHasOccured())
    HandleError();
</code></pre>

<p><a href="http://www.gotw.ca/gotw/086.htm" rel="noreferrer">Guru of the Week</a> (deals with C++ but relevant here), where I picked this up.</p>

<p><a href="http://www.archivum.info/comp.std.c/2007-11/00083/Re-extended-operators.html" rel="noreferrer">Possible origin of trigraphs</a> or as @DwB points out in the comments it's more likely due to EBCDIC being difficult (again). <a href="http://www.ibm.com/developerworks/forums/thread.jspa?messageID=14505849" rel="noreferrer">This</a> discussion on the IBM developerworks board seems to support that theory.</p>

<p>From ISO/IEC 9899:1999 §5.2.1.1, footnote 12 (h/t @Random832):</p>

<blockquote>
  <p>The trigraph sequences enable the input of characters that are not defined in the Invariant Code Set as
  described in ISO/IEC 646, which is a subset of the seven-bit US ASCII code set.</p>
</blockquote>
</tr></td><tr><td><p>It's a C <a href="http://en.wikipedia.org/wiki/Digraphs_and_trigraphs#C" rel="noreferrer">trigraph</a>. <code>??!</code> is <code>|</code>, so <code>??!??!</code> is the operator <code>||</code></p>
</tr></td><tr><td><p>Well, why this exists in general is probably different than why it exists in your example.</p>

<p>It all started half a century ago with repurposing hardcopy communication terminals as computer user interfaces. In the initial Unix and C era that was the ASR-33 Teletype. </p>

<p>This device was slow (10 cps) and noisy and ugly and its view of the ASCII character set ended at 0x5f, so it had (look closely at the pic) none of the keys:</p>

<pre><code>{ | } ~ 
</code></pre>

<p><a href="http://www.codingstandard.com/rule/2-2-1-do-not-use-digraphs-or-trigraphs/" rel="noreferrer">The trigraphs</a> were defined to fix a specific problem. The idea was that C programs could use the ASCII subset found on the ASR-33 and in other environments missing the high ASCII values.</p>

<blockquote>
  <p><strong>Your example is actually two of <code>??!</code>, each meaning <code>|</code>, so the result is <code>||</code>.</strong></p>
</blockquote>

<p>However, people writing C code almost by definition had modern equipment,<sup>1</sup> so my guess is: <em>someone showing off or amusing themself,</em> leaving a kind of Easter egg in the code for you to find.</p>

<p>It sure worked, it led to a wildly popular SO question.</p>

<p><a href="https://i.stack.imgur.com/WbaCR.jpg" rel="noreferrer"><img src="https://i.stack.imgur.com/WbaCR.jpg" alt="ASR-33 Teletype"></a></p>

<p><sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASR-33 Teletype</sup>
<hr>
<sup>1. For that matter, the trigraphs were invented by the ANSI committee, which first met <em>after</em> C become a runaway success, so none of the original C code or coders would have used them.</sup></p>
</tr></td><tr><td><p>As already stated <code>??!??!</code> is essentially two <strong><a href="https://en.wikipedia.org/wiki/Digraphs_and_trigraphs#C" rel="noreferrer">trigraphs</a></strong> (<code>??!</code> and <code>??!</code> again)  mushed together that get replaced-translated to <code>||</code>, i.e the <a href="https://en.wikipedia.org/wiki/Operators_in_C_and_C%2B%2B#Logical_operators" rel="noreferrer"><strong>logical OR</strong></a>, by the preprocessor.</p>
<p>The following table containing every trigraph should help disambiguate alternate trigraph combinations:</p>
<pre class="lang-none prettyprint-override"><code>Trigraph   Replaces

??(        [
??)        ]
??&lt;        {
??&gt;        }
??/        \
??'        ^
??=        #
??!        |
??-        ~
</code></pre>
<p><sup>Source: <em><a href="http://careferencemanual.com/" rel="noreferrer">C: A Reference Manual 5th Edition</a></em></sup></p>
<p>So a trigraph that looks like <code>??(??)</code> will eventually map to <code>[]</code>, <code>??(??)??(??)</code> will get replaced by <code>[][]</code> and so on, you get the idea.</p>
<p>Since trigraphs are substituted during preprocessing you could use <a href="https://gcc.gnu.org/onlinedocs/cpp/Overview.html" rel="noreferrer"><code>cpp</code></a> to get a view of the output yourself, using a silly <code>trigr.c</code> program:</p>
<pre><code>void main(){ const char *s = &quot;??!??!&quot;; } 
</code></pre>
<p>and processing it with:</p>
<pre><code>cpp -trigraphs trigr.c 
</code></pre>
<p>You'll get a console output of</p>
<pre><code>void main(){ const char *s = &quot;||&quot;; }
</code></pre>
<p>As you can notice, the option <code>-trigraphs</code> must be specified or else <code>cpp</code> will issue a warning; this indicates how <em>trigraphs are a thing of the past and of no modern value other than confusing people who might bump into them</em>.</p>
<hr />
<p>As for the rationale behind the introduction of trigraphs, it is better understood when looking at <a href="https://en.wikipedia.org/wiki/ISO/IEC_646#History" rel="noreferrer">the history section of ISO/IEC 646</a>:</p>
<blockquote>
<p>ISO/IEC 646 and its predecessor ASCII (ANSI X3.4) largely endorsed existing practice regarding character encodings in the telecommunications industry.</p>
<p><em>As ASCII did not provide a number of characters needed for languages other than English, <strong>a number of national variants were made that substituted some less-used characters with needed ones</strong></em>.</p>
</blockquote>
<p><sup>(emphasis mine)</sup></p>
<p>So, in essence, some needed characters (those for which a trigraph exists) were replaced in certain national variants. This leads to the alternate representation using trigraphs comprised of characters that other variants still had around.</p>
</tr></td>