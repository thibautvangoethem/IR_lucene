<head>
<style>
td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
</style>
</head><h1>Check for changes to an SQL Server table?</h1><p>How can I monitor an SQL Server database for changes to a table without using triggers or modifying the structure of the database in any way? My preferred programming environment is <a href="http://en.wikipedia.org/wiki/.NET_Framework" rel="noreferrer">.NET</a> and C#.</p>

<p>I'd like to be able to support any <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#Genesis" rel="noreferrer">SQL Server 2000</a> SP4 or newer. My application is a bolt-on data visualization for another company's product. Our customer base is in the thousands, so I don't want to have to put in requirements that we modify the third-party vendor's table at every installation.</p>

<p>By <em>"changes to a table"</em> I mean changes to table data, not changes to table structure.</p>

<p>Ultimately, I would like the change to trigger an event in my application, instead of having to check for changes at an interval.</p>

<hr>

<p>The best course of action given my requirements (no triggers or schema modification, SQL Server 2000 and 2005) seems to be to use the <code>BINARY_CHECKSUM</code> function in <a href="http://en.wikipedia.org/wiki/Transact-SQL" rel="noreferrer">T-SQL</a>. The way I plan to implement is this:</p>

<p>Every X seconds run the following query:</p>

<pre><code>SELECT CHECKSUM_AGG(BINARY_CHECKSUM(*))
FROM sample_table
WITH (NOLOCK);
</code></pre>

<p>And compare that against the stored value. If the value has changed, go through the table row by row using the query:</p>

<pre><code>SELECT row_id, BINARY_CHECKSUM(*)
FROM sample_table
WITH (NOLOCK);
</code></pre>

<p>And compare the returned checksums against stored values.</p>
<table> <tr><th>answers</th></tr><tr><td><p>Why don't you want to use triggers?  They are a good thing if you use them correctly.  If you use them as a way to enforce referential integrity that is when they go from good to bad.  But if you use them for monitoring, they are not really considered taboo.</p>
</tr></td><tr><td><p>Have a DTS job (or a job that is started by a windows service) that runs at a given interval. Each time it is run, it gets information about the given table by using the system <a href="http://msdn.microsoft.com/en-us/library/ms186778.aspx" rel="noreferrer">INFORMATION_SCHEMA</a> tables, and records this data in the data repository. Compare the data returned regarding the structure of the table with the data returned the previous time. If it is different, then you know that the structure has changed.</p>

<p>Example query to return information regarding all of the columns in table ABC (ideally listing out just the columns from the INFORMATION_SCHEMA table that you want, instead of using *select ** like I do here):</p>

<pre><code>select * from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = 'ABC'
</code></pre>

<p>You would monitor different columns and INFORMATION_SCHEMA views depending on how exactly you define "changes to a table".</p>
</tr></td><tr><td><p>Take a look at the CHECKSUM command:</p>

<pre><code>SELECT CHECKSUM_AGG(BINARY_CHECKSUM(*)) FROM sample_table WITH (NOLOCK);
</code></pre>

<p>That will return the same number each time it's run as long as the table contents haven't changed. See my post on this for more information:</p>

<p><a href="http://msdn.microsoft.com/en-us/library/aa258245(SQL.80).aspx" rel="noreferrer">CHECKSUM</a></p>

<p>Here's how I used it to rebuild cache dependencies when tables changed:<br>
<a href="http://weblogs.asp.net/jgalloway/archive/2005/05/07/406056.aspx" rel="noreferrer">ASP.NET 1.1 database cache dependency (without triggers)</a></p>
</tr></td>